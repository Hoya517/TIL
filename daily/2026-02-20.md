# âš™ï¸ TIL - Spring Cloud Config (Config Server)

## ğŸ“… Todayâ€™s Learning
- Spring Cloud Config ê°œë… ì´í•´
- Config Server (Native Mode) êµ¬ì¶•
- Config Client(Product Service) ì—°ë™
- í™˜ê²½ë³„ í”„ë¡œí•„(local) êµ¬ì„± ê´€ë¦¬
- /actuator/refresh ë¥¼ í†µí•œ ì„¤ì • ë™ì  ë°˜ì˜ ì‹¤ìŠµ

---

# 1ï¸âƒ£ Spring Cloud Configë€?

Spring Cloud ConfigëŠ” **ë¶„ì‚° ì‹œìŠ¤í…œ í™˜ê²½ì—ì„œ ì¤‘ì•™ ì§‘ì¤‘ì‹ ì„¤ì • ê´€ë¦¬**ë¥¼ ì œê³µí•˜ëŠ” í”„ë ˆì„ì›Œí¬ì´ë‹¤.

## í•µì‹¬ ëª©ì 

- ëª¨ë“  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ ì„¤ì •ì„ ì¤‘ì•™ì—ì„œ ê´€ë¦¬
- í™˜ê²½(dev/local/prod) ë³„ ì„¤ì • ë¶„ë¦¬
- ì„¤ì • ë³€ê²½ ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ë°°í¬ ìµœì†Œí™”

---

# 2ï¸âƒ£ ì•„í‚¤í…ì²˜ êµ¬ì„±

- Eureka Server
- Config Server (Native Mode)
- Product Service (Config Client)

ë™ì‘ íë¦„:

Product Service ì‹¤í–‰  
â†’ Config Server ì¡°íšŒ  
â†’ profile(local)ì— ë§ëŠ” ì„¤ì • ë¡œë“œ  
â†’ ì„œë²„ í¬íŠ¸ ë° message ê°’ ì ìš©

---

# 3ï¸âƒ£ Config Server ì„¤ì •

## ì˜ì¡´ì„±

implementation 'org.springframework.cloud:spring-cloud-config-server'  
implementation 'org.springframework.boot:spring-boot-starter-web'

## ë©”ì¸ í´ë˜ìŠ¤

@EnableConfigServer  
@SpringBootApplication  
public class ConfigApplication {  
    public static void main(String[] args) {  
        SpringApplication.run(ConfigApplication.class, args);  
    }  
}

## application.yml

server:  
  port: 18080  

spring:  
  profiles:  
    active: native  
  application:  
    name: config-server  
  cloud:  
    config:  
      server:  
        native:  
          search-locations: classpath:/config-repo  

---

# 4ï¸âƒ£ ì„¤ì • íŒŒì¼ êµ¬ì¡° (Native Mode)

resources/config-repo/

product-service.yml  
product-service-local.yml  

product-service-local.yml ì˜ˆì‹œ:

server:  
  port: 19083  

message: "product-service-local message"

---

# 5ï¸âƒ£ Product Service (Config Client)

## ì˜ì¡´ì„±

implementation 'org.springframework.cloud:spring-cloud-starter-config'

## application.yml

server:  
  port: 0  

spring:  
  profiles:  
    active: local  
  application:  
    name: product-service  
  config:  
    import: "configserver:"  
  cloud:  
    config:  
      discovery:  
        enabled: true  
        service-id: config-server  

management:  
  endpoints:  
    web:  
      exposure:  
        include: refresh  

---

# 6ï¸âƒ£ @RefreshScope

@RefreshScope  
@RestController  
@RequestMapping("/product")  
public class ProductController {  

    @Value("${server.port}")  
    private String serverPort;  

    @Value("${message}")  
    private String message;  

    @GetMapping  
    public String getProduct() {  
        return "Product detail from PORT : "  
                + serverPort + " and message : " + message;  
    }  
}

---

# 7ï¸âƒ£ ì‹¤í–‰ ê²°ê³¼

1) Product ì‹¤í–‰ ì‹œ local í”„ë¡œí•„ ì ìš© â†’ port 19083  
2) /product í˜¸ì¶œ ì‹œ message ì¶œë ¥  
3) Config Serverì˜ message ìˆ˜ì •  
4) POST /actuator/refresh í˜¸ì¶œ  
5) ì¬í˜¸ì¶œ ì‹œ message ê°’ ë³€ê²½ í™•ì¸  

---

# ğŸ¯ ì˜¤ëŠ˜ì˜ í•µì‹¬ ì¸ì‚¬ì´íŠ¸

- ì„¤ì •ì„ ì½”ë“œì—ì„œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ MSAì˜ ê¸°ë³¸ ì „ëµì´ë‹¤.
- Config ServerëŠ” ë°°í¬ ì—†ì´ ì„¤ì • ë³€ê²½ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.
- Native ModeëŠ” ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©, ì‹¤ë¬´ëŠ” Git ê¸°ë°˜ì´ ì¼ë°˜ì ì´ë‹¤.
- @RefreshScopeëŠ” ë™ì  ì„¤ì • ë°˜ì˜ì˜ í•µì‹¬ì´ë‹¤.

---

# ğŸ ì •ë¦¬

Spring Cloud ConfigëŠ”  
"ì„¤ì •ì˜ ì¤‘ì•™ì§‘ì¤‘í™”"ë¥¼ í†µí•´ MSA ìš´ì˜ ë³µì¡ë„ë¥¼ ë‚®ì¶”ëŠ” ë„êµ¬ì´ë‹¤.

ë‹¤ìŒ í™•ì¥ í¬ì¸íŠ¸:

- Git ê¸°ë°˜ Config Server êµ¬ì„±
- Spring Cloud Bus + Kafka ì—°ë™ìœ¼ë¡œ ìë™ refresh
- ìš´ì˜ í™˜ê²½ ë¶„ë¦¬ ì „ëµ(dev/staging/prod)
