# TIL - Spring Cloud Distributed Tracing (Micrometer + Zipkin)

## 1. 분산 추적 개념 정리

### ✔ Trace

-   하나의 요청이 여러 서비스를 거치는 전체 흐름
-   하나의 Trace는 여러 Span으로 구성됨
-   모든 Span은 동일한 Trace ID를 공유

### ✔ Span

-   Trace 내부의 최소 단위 작업
-   시작/종료 시간 보유
-   부모-자식 관계 형성 가능
-   특정 서비스 내부 처리 구간을 표현

### ✔ Context

-   Trace ID, Span ID 등을 포함
-   서비스 간 호출 시 전파됨
-   전체 요청 흐름을 연결하는 역할

------------------------------------------------------------------------

## 2. 왜 분산 추적이 필요한가?

MSA 환경에서는: 
-   서비스 간 호출이 복잡하게 연결됨 
-   병목 지점 파악이 어려움 
-   단순 로그만으로는 원인 분석이 힘듦

→ Trace 기반 시각화를 통해 호출 흐름과 성능 문제를 빠르게 분석 가능

------------------------------------------------------------------------

## 3. Micrometer

-   Spring 기반 애플리케이션 메트릭 수집 라이브러리
-   Prometheus, Grafana 연동 가능
-   Micrometer Tracing을 통해 분산 추적 지원

추가 의존성: - micrometer-tracing-bridge-brave - feign-micrometer -
zipkin-reporter-brave

------------------------------------------------------------------------

## 4. Zipkin

### ✔ 역할

-   Trace/Span 데이터 수집
-   시각화 제공
-   검색 및 필터링 지원

### ✔ 실행

    docker run -d -p 9411:9411 openzipkin/zipkin

접속 URL: http://localhost:9411

------------------------------------------------------------------------

## 5. 실습 구성

구성: - Eureka Server - Order Service - Product Service - Zipkin

### 설정 핵심

application.yml:

    management:
      zipkin:
        tracing:
          endpoint: "http://localhost:9411/api/v2/spans"
      tracing:
        sampling:
          probability: 1.0

-   sampling 1.0 → 모든 요청 추적

------------------------------------------------------------------------

## 6. 실행 결과

1.  /order 요청
2.  Order → Product 호출 발생
3.  Zipkin 대시보드에서 Trace 조회
4.  3개의 Span 확인
5.  Order → Product 호출 관계 시각화 확인

------------------------------------------------------------------------

## 7. 핵심 학습 포인트

-   Trace ID는 전체 요청 단위
-   Span은 각 서비스 내부 처리 단위
-   Context는 서비스 간 자동 전파
-   Micrometer + Brave 조합으로 자동 추적 구성
-   Zipkin을 통해 병목 구간 시각화 가능

------------------------------------------------------------------------

## 8. 오늘의 정리

단순 로그 기반 디버깅을 넘어 "요청 흐름 전체를 시각적으로 분석하는 방식"을 학습

MSA 환경에서 필수적인 관측 가능성(Observability)의 핵심 개념 이해
