
# ğŸ“˜ TIL - API Gateway (Spring Cloud Gateway)

## ğŸ“… Todayâ€™s Learning
- API Gateway ê°œë… ì´í•´
- Spring Cloud Gateway ì„¤ì •
- Eureka ì—°ë™ ë° ë™ì  ë¼ìš°íŒ…
- Global Filter (Pre/Post) êµ¬í˜„
- Gatewayë¥¼ í†µí•œ ë¡œë“œ ë°¸ëŸ°ì‹± í™•ì¸

---

# 1ï¸âƒ£ API Gatewayë€?

API GatewayëŠ” ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì™€ ë‚´ë¶€ ì„œë¹„ìŠ¤ ì‚¬ì´ì˜ ë‹¨ì¼ ì§„ì…ì (Single Entry Point) ì—­í• ì„ í•œë‹¤.

## ì—­í• 

- ìš”ì²­ ë¼ìš°íŒ…
- ì¸ì¦ ë° ê¶Œí•œ ê²€ì¦
- ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§
- í•„í„°ë§
- ì‘ë‹µ ë³€í™˜
- ë¡œë“œ ë°¸ëŸ°ì‹±

MSA í™˜ê²½ì—ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì— ì§ì ‘ ì ‘ê·¼í•˜ì§€ ì•Šë„ë¡ ì¶”ìƒí™”í•˜ëŠ” ê³„ì¸µì´ë‹¤.

---

# 2ï¸âƒ£ Spring Cloud Gateway

Spring ê¸°ë°˜ì˜ ë¦¬ì•¡í‹°ë¸Œ API Gateway.

## íŠ¹ì§•

- WebFlux ê¸°ë°˜ (Reactive)
- ë™ì  ë¼ìš°íŒ… ì§€ì›
- í•„í„° ì²´ì¸ êµ¬ì¡°
- Eurekaì™€ í†µí•© ê°€ëŠ¥
- lb:// í”„ë¡œí† ì½œì„ í†µí•œ ë¡œë“œë°¸ëŸ°ì‹±

---

# 3ï¸âƒ£ ê¸°ë³¸ ì„¤ì •

## ì˜ì¡´ì„±

```groovy
implementation 'org.springframework.cloud:spring-cloud-starter-gateway'
implementation 'org.springframework.cloud:spring-cloud-starter-netflix-eureka-client'
implementation 'org.springframework.boot:spring-boot-starter-actuator'
```

---

## application.yml

```yaml
server:
  port: 19091

spring:
  main:
    web-application-type: reactive
  application:
    name: gateway-service
  cloud:
    gateway:
      routes:
        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/order/**
        - id: product-service
          uri: lb://product-service
          predicates:
            - Path=/product/**
      discovery:
        locator:
          enabled: true

eureka:
  client:
    service-url:
      defaultZone: http://localhost:19090/eureka/
```

### í•µì‹¬ í¬ì¸íŠ¸

- lb:// â†’ Eureka ê¸°ë°˜ ë¡œë“œë°¸ëŸ°ì‹±
- Path Predicate â†’ ìš”ì²­ ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ…
- discovery locator â†’ ë™ì  ë¼ìš°íŒ… í™œì„±í™”

---

# 4ï¸âƒ£ Global Filter

## Pre Filter

ìš”ì²­ì´ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬ë˜ê¸° ì „ ì‹¤í–‰

```java
@Component
public class CustomPreFilter implements GlobalFilter, Ordered {

    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        System.out.println("Pre Filter: " + exchange.getRequest().getURI());
        return chain.filter(exchange);
    }

    @Override
    public int getOrder() {
        return Ordered.HIGHEST_PRECEDENCE;
    }
}
```

---

## Post Filter

ì‘ë‹µì´ í´ë¼ì´ì–¸íŠ¸ë¡œ ë°˜í™˜ë˜ê¸° ì§ì „ ì‹¤í–‰

```java
@Component
public class CustomPostFilter implements GlobalFilter, Ordered {

    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        return chain.filter(exchange).then(Mono.fromRunnable(() -> {
            System.out.println("Post Filter: " + exchange.getResponse().getStatusCode());
        }));
    }

    @Override
    public int getOrder() {
        return Ordered.LOWEST_PRECEDENCE;
    }
}
```

---

# 5ï¸âƒ£ ì‹¤ìŠµ ì•„í‚¤í…ì²˜

Eureka + Gateway + Order(1) + Product(2)

ë™ì‘ íë¦„:

Client  
â†’ Gateway (Pre Filter)  
â†’ Eureka ì¡°íšŒ  
â†’ Product ì¸ìŠ¤í„´ìŠ¤ ì„ íƒ  
â†’ ì‘ë‹µ  
â†’ Gateway (Post Filter)  
â†’ Client

---

# 6ï¸âƒ£ ë¡œë“œë°¸ëŸ°ì‹± í™•ì¸

/product ìš”ì²­ ë°˜ë³µ í˜¸ì¶œ ì‹œ

Product info!!!!! From port : 19093  
Product info!!!!! From port : 19094  

í¬íŠ¸ê°€ ë²ˆê°ˆì•„ê°€ë©° ì‘ë‹µ â†’ Gateway + Eureka + LoadBalancer ì •ìƒ ë™ì‘ í™•ì¸

---

# 7ï¸âƒ£ Zuul (Spring Boot 2)

- Spring Boot 2 í™˜ê²½ì—ì„œëŠ” Zuul ì‚¬ìš©
- ê¸°ëŠ¥ì€ Gatewayì™€ ìœ ì‚¬
- í˜„ì¬ëŠ” Spring Cloud Gatewayê°€ ì£¼ë ¥

---

# ğŸ¯ ì˜¤ëŠ˜ì˜ í•µì‹¬ ì¸ì‚¬ì´íŠ¸

1. GatewayëŠ” ë‹¨ìˆœ ë¼ìš°í„°ê°€ ì•„ë‹ˆë¼ ë³´ì•ˆê³¼ ì •ì±…ì˜ ì¤‘ì‹¬ì´ë‹¤.
2. í´ë¼ì´ì–¸íŠ¸ëŠ” ë‚´ë¶€ ì„œë¹„ìŠ¤ êµ¬ì¡°ë¥¼ ëª°ë¼ë„ ëœë‹¤.
3. ë¡œë“œë°¸ëŸ°ì‹±ì€ Gatewayê°€ ì•„ë‹ˆë¼ Service Discovery ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤.
4. í•„í„°ëŠ” ë¹„ë™ê¸° ì²´ì¸ êµ¬ì¡°ë¡œ ë™ì‘í•œë‹¤ (Mono ê¸°ë°˜).

---

# ğŸ ì •ë¦¬

API GatewayëŠ”

MSAì—ì„œ íŠ¸ë˜í”½ì„ í†µì œí•˜ëŠ” ê´€ë¬¸ì´ë‹¤.

ì„œë¹„ìŠ¤ê°€ ë§ì•„ì§ˆìˆ˜ë¡ Gatewayì˜ ì—­í• ì€ ë” ì¤‘ìš”í•´ì§„ë‹¤.
